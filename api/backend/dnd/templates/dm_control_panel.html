{% extends "base.html" %}

{% block title %}DM Control Panel{% endblock %}

{% block content %}
    <h1>DM Control Panel</h1>
    <h2>Boradcast Message</h2>
    <form id="broadcastForm">
        <label for="broadcastMessage">Message:</label>
        <input type="text" id="broadcastMessage" placeholder="Enter message">
        <button type="submit">Send to All</button>
    </form>
    <h2>Select Artwork to Display</h2>
    <form id="artworkForm">
        <select name="artwork">
            {% for artwork in artworks %}
                <option value="{{ artwork.id }}">{{ artwork.title }}</option>
            {% endfor %}
        </select>
        <label>Target Player:</label>
        <select name="player">
            <option value="">All Players</option>
            {% for player in players %}
                <option value="{{ player.id }}">{{ player.username }}</option>
            {% endfor %}
        </select>
        <button type="submit">Display Artwork</button>
    </form>
{% endblock %}

{% block scripts %}
<script>
    const dmSocket = new WebSocket(
        "ws://" + window.location.host + "/ws/dm/"
    );

    dmSocket.onopen = function(e) {
        console.log("DM Websocket connected");
    };

    dmSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log("Received message from server:", data.message);
    }

    function broadcastMessage() {
        const messageInput = document.getElementById("broadcastMessage");
        const message = messageInput.value;
        if (dmSocket.readyState === WebSocket.OPEN) {
            dmSocket.send(JSON.stringify({
                "message": message
            }));
            messageInput.value = "";
        } else {
            console.error("WebSocket connection is not open.");
        }
    }

    document.getElementById("broadcastForm").addEventListener("submit", function(event) {
        event.preventDefault();
        broadcastMessage();
    });
</script>
{% endblock %}
